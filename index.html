<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dikana Online | Ø¯Ú©Ø§Ù†Û• Ø¦Û†Ù†Ù„Ø§ÛŒÙ†</title>
    
    <!-- Bootstrap 5 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Map & PDF Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- QR Code Library for PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --bg: #f8fafc;
        }

        body {
            font-family: 'Noto Kufi Arabic', sans-serif;
            background-color: var(--bg);
            padding-bottom: 80px;
        }

        .mobile-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.05);
            position: relative;
        }

        /* Hero Image Area */
        .product-header {
            position: relative;
            height: 380px;
            overflow: hidden;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .product-header img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .overlay-gradient {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 150px;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            pointer-events: none;
        }
        .price-tag {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 800;
            color: var(--primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 1.2rem;
            z-index: 2;
        }

        /* Custom Cards */
        .info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.03);
            border: 1px solid #f1f5f9;
            margin-bottom: 15px;
        }

        .btn-main {
            padding: 15px;
            border-radius: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            transition: 0.2s;
        }
        .btn-whatsapp { background-color: #25D366; color: white; border: none; }
        .btn-pdf { background-color: #ef4444; color: white; border: none; }
        .btn-main:active { transform: scale(0.98); }

        /* Map */
        #map { height: 250px; border-radius: 16px; width: 100%; border: 2px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        /* Hidden Invoice for PDF Generation */
        #invoice-template {
            display: none; /* Hidden on screen */
            background: white;
            padding: 30px;
            width: 100%;
            font-family: 'Noto Kufi Arabic', sans-serif;
            border: 1px solid #ddd;
        }
        .invoice-header { border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .invoice-table th { background-color: #f8f9fa; }
    </style>
</head>
<body>

<div class="mobile-container">
    
    <!-- ================== ÙˆØ¶Ø¹ Ø§Ù„ØªØ§Ø¬Ø± ================== -->
    <div id="merchantView" class="d-none">
        <div class="p-4">
            <h4 class="fw-bold text-primary mb-1">Ø¯Ú©Ø§Ù†Û• Ø¦Û†Ù†Ù„Ø§ÛŒÙ† <i class="fas fa-store"></i></h4>
            <p class="text-muted small">Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ù†Ø§ Ù„ÛŒÙ†Ú©Û•Ú©Û Ù†ÙˆÛŒ</p>
            
            <div class="info-card text-center" onclick="document.getElementById('fileInput').click()" style="cursor: pointer; border: 2px dashed #cbd5e1;">
                <div id="uploadPlaceholder">
                    <i class="fas fa-image fa-3x text-muted mb-2"></i>
                    <h6 class="fw-bold">ÙˆÛÙ†Û•ÛŒÛ•Ú©Û Ø¨Ø§Ø±Ú©Û•</h6>
                </div>
                <img id="previewImg" class="img-fluid rounded" style="display:none; max-height: 200px;">
                <input type="file" id="fileInput" accept="image/*" class="d-none" onchange="handleImageUpload()">
                <div class="progress mt-3 d-none" style="height: 5px;">
                    <div class="progress-bar bg-success" id="uploadBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="mb-3">
                <label class="fw-bold small mb-1">Ù†Ø§Ú¤Û Ø¨Û•Ø±Ù‡Û•Ù…ÛŒ</label>
                <input type="text" id="pName" class="form-control form-control-lg bg-light border-0">
            </div>
            <div class="mb-3">
                <label class="fw-bold small mb-1">Ø¨Ù‡Ø§ (Ø¯ÛŒÙ†Ø§Ø±)</label>
                <input type="number" id="pPrice" class="form-control form-control-lg bg-light border-0">
            </div>
            <div class="mb-4">
                <label class="fw-bold small mb-1">Ù¾ÛØ²Ø§Ù†ÛŒÙ†</label>
                <textarea id="pDesc" class="form-control bg-light border-0" rows="3"></textarea>
            </div>

            <button onclick="generateLink()" class="btn-main" style="background: var(--primary); color: white;">
                Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ù† Ùˆ Ú©Û†Ù¾ÛŒÚ©Ø±Ù† <i class="fas fa-link"></i>
            </button>
        </div>
    </div>

    <!-- ================== ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø¨ÙˆÙ† ================== -->
    <div id="customerView" class="d-none">
        <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
        <div class="product-header">
            <img id="cImg" src="">
            <div class="overlay-gradient"></div>
            <div class="price-tag" id="cPriceBadge">0 Ø¯.Ø¹</div>
        </div>

        <div class="container" style="position: relative; top: -20px; z-index: 10;">
            
            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„ÙƒÙ…ÙŠØ© -->
            <div class="info-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h4 id="cName" class="fw-bold mb-1">...</h4>
                        <p id="cDesc" class="text-muted small mb-0">...</p>
                    </div>
                    <div class="d-flex align-items-center bg-light rounded-pill px-2 py-1">
                        <button class="btn btn-sm" onclick="updateQty(-1)"><i class="fas fa-minus"></i></button>
                        <span id="qtyDisplay" class="fw-bold mx-2">1</span>
                        <button class="btn btn-sm" onclick="updateQty(1)"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
            </div>

            <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„ØªÙˆØµÙŠÙ„ -->
            <div class="info-card">
                <h6 class="fw-bold mb-3"><i class="fas fa-truck text-primary ms-2"></i>Ø¬Ù‡Û Ú¯Û•Ù‡Ø§Ù†Ø¯Ù†Û Ù‡Û•Ù„Ø¨Ú˜ÛØ±Û•:</h6>
                <select id="citySelect" class="form-select form-select-lg bg-light border-0 fw-bold" onchange="updateTotal()">
                    <option value="3000">Ø²Ø§Ø®Û† / Ø¯Ù‡Û†Ú© (3,000 Ø¯.Ø¹)</option>
                    <option value="5000">Ù‡Û•ÙˆÙ„ÛØ± / Ø³Ù„ÛÙ…Ø§Ù†ÛŒ (5,000 Ø¯.Ø¹)</option>
                    <option value="10000">Ø¯Û•Ø±Ú¤Û•ÛŒ Ù‡Û•Ø±ÛÙ…Û (10,000 Ø¯.Ø¹)</option>
                </select>
                
                <hr class="my-3">
                
                <div class="d-flex justify-content-between fw-bold h5 mb-0 text-primary">
                    <span>Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ (Ø³Û•Ø±Ø¬Û•Ù…):</span>
                    <span id="sTotal">0</span>
                </div>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† ÙˆØ§Ù„Ø®Ø±ÙŠØ·Ø© -->
            <div class="info-card">
                <h6 class="fw-bold mb-3"><i class="fas fa-user-edit text-primary ms-2"></i>Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛÙ† ÙˆÛ•Ø±Ú¯Ø±ØªÙ†Û</h6>
                <input type="text" id="custName" class="form-control mb-2 bg-light border-0" placeholder="Ù†Ø§Ú¤Û Ø³ÛŒØ§Ù†ÛŒ">
                <input type="tel" id="custPhone" class="form-control mb-3 bg-light border-0" placeholder="Ú˜Ù…Ø§Ø±Ø§ Ù…Û†Ø¨Ø§ÛŒÙ„Û (0750...)">
                
                <div class="position-relative mb-2">
                    <div id="map"></div>
                    <button onclick="getMyLocation()" class="btn btn-light position-absolute bottom-0 start-0 m-2 shadow-sm fw-bold" style="z-index: 500; font-size: 0.8rem;">
                        <i class="fas fa-crosshairs text-danger"></i> Ø¬Ù‡Û Ù…Ù†
                    </button>
                </div>
                <small class="text-muted d-block text-center mb-2" id="geoStatus">Ù‡ÛŒÚ¤ÛŒÛ• Ø¬Ù‡Û Ø®Û† Ù„ Ø³Û•Ø± Ù†Û•Ø®Ø´Û•ÛŒ Ø¯ÛŒØ§Ø± Ø¨Ú©Û•</small>
                
                <textarea id="custAddress" class="form-control bg-light border-0" rows="2" placeholder="Ù†ÛŒØ´Ø§Ù†Û•Ú©Ø§ Ø¯ÛŒØ§Ø± (Ù…Ø²Ú¯Û•ÙØªØŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•...)"></textarea>
            </div>

            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
            <div class="d-flex gap-2 pb-4">
                <button onclick="sendOrder()" class="btn-main btn-whatsapp">
                    ÙØ±ÛÚ©Ø±Ù† (WhatsApp) <i class="fab fa-whatsapp fa-lg"></i>
                </button>
                <button onclick="downloadPDF()" class="btn-main btn-pdf" style="width: 40%;">
                    PDF <i class="fas fa-file-pdf"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ================== Ù‚Ø§Ù„Ø¨ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ù…Ø®ÙÙŠ) ================== -->
<div id="invoice-template">
    <div class="invoice-header d-flex justify-content-between align-items-center">
        <div>
            <h2 class="fw-bold text-primary">Ø¯Ú©Ø§Ù†Û• Ø¦Û†Ù†Ù„Ø§ÛŒÙ†</h2>
            <p class="text-muted mb-0">Ù¾Ø³ÙˆÙˆÙ„Û•ÛŒØ§ Ú©Ú•ÛŒÙ†Û (Invoice)</p>
        </div>
        <div class="text-end">
            <h5 class="fw-bold" id="inv-date">2025/11/25</h5>
            <small class="text-muted">Order ID: #<span id="inv-id">12345</span></small>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-6">
            <h6 class="fw-bold text-decoration-underline">Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛÙ† Ú©Ø±ÛŒØ§Ø±ÛŒ:</h6>
            <p class="mb-1" id="inv-custName">-</p>
            <p class="mb-1" id="inv-custPhone">-</p>
            <p class="mb-0 small text-muted" id="inv-address">-</p>
        </div>
        <div class="col-6 text-end">
            <div id="qrcode" style="display: flex; justify-content: flex-end;"></div>
            <small class="d-block mt-1">Ø³Ú©Ø§Ù† Ø¨Ú©Û• Ø¨Û† Ù„ÙˆÚ©Û•ÛŒØ´Ù†</small>
        </div>
    </div>

    <table class="table table-bordered text-center align-middle invoice-table">
        <thead>
            <tr>
                <th>Ø¨Û•Ø±Ù‡Û•Ù…</th>
                <th>Ø¨Ù‡Ø§</th>
                <th>Ù‡Ú˜Ù…Ø§Ø±</th>
                <th>Ø³Û•Ø±Ø¬Û•Ù…</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="inv-pName" class="fw-bold">-</td>
                <td id="inv-pPrice">-</td>
                <td id="inv-qty">-</td>
                <td id="inv-subtotal">-</td>
            </tr>
            <tr>
                <td colspan="3" class="text-end fw-bold">Ú¯Û•Ù‡Ø§Ù†Ø¯Ù† (Delivery)</td>
                <td id="inv-delivery">-</td>
            </tr>
            <tr class="table-primary">
                <td colspan="3" class="text-end fw-bold h5">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ</td>
                <td class="fw-bold h5" id="inv-total">-</td>
            </tr>
        </tbody>
    </table>

    <div class="mt-4 text-center text-muted small border-top pt-3">
        <p class="mb-1">Ø³ÙˆÙ¾Ø§Ø³ Ø¨Û† Ú©Ú•ÛŒÙ†Ø§ ÙˆÛ• Ú˜ Ø¯Ú©Ø§Ù†Ø§ Ù…Û•</p>
        <p>Ù‡Û•Ø± Ù¾Ø±Ø³ÛŒØ§Ø±Û•Ú© Ù‡Û•Ø¨ÛŒØª Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒÛ Ø¨ 07503727069 Ø¨Ú©Û•</p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Constants
    const MERCHANT_PHONE = "9647503727069";
    const API_KEY = "6d207e02198a847aa98d0a2a901485a5";

    // Variables
    let productData = { img: '', name: '', price: 0, desc: '' };
    let orderData = { qty: 1, lat: null, lng: null };
    let map, marker;

    // Init
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        if (params.has('p')) {
            document.getElementById('customerView').classList.remove('d-none');
            loadCustomer(params);
        } else {
            document.getElementById('merchantView').classList.remove('d-none');
        }
    };

    // ================= Merchant Logic =================
    async function handleImageUpload() {
        const file = document.getElementById('fileInput').files[0];
        if (!file) return;

        // Preview
        const reader = new FileReader();
        reader.onload = e => {
            document.getElementById('previewImg').src = e.target.result;
            document.getElementById('previewImg').style.display = 'block';
            document.getElementById('uploadPlaceholder').style.display = 'none';
        };
        reader.readAsDataURL(file);

        // Upload
        const formData = new FormData();
        formData.append("image", file);
        document.querySelector('.progress').classList.remove('d-none');
        
        try {
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, { method: "POST", body: formData });
            const data = await res.json();
            document.getElementById('uploadBar').style.width = "100%";
            if (data.success) productData.img = data.data.url;
        } catch (e) { alert("Ú©ÛØ´Û• Ù„ Ø¨Ø§Ø±Ú©Ø±Ù†Ø§ ÙˆÛÙ†Û•ÛŒ!"); }
    }

    function generateLink() {
        const name = document.getElementById('pName').value.trim();
        const price = document.getElementById('pPrice').value;
        const desc = document.getElementById('pDesc').value;
        const img = productData.img || "https://placehold.co/600x400/png?text=No+Image";

        if(!name || !price) return alert("Ù‡ÛŒÚ¤ÛŒÛ• Ù†Ø§Ú¤ Ùˆ Ø¨Ù‡Ø§ÛŒ Ø¨Ù†Ú¤ÛŒØ³Û•");

        const url = `${window.location.href.split('?')[0]}?p=${encodeURIComponent(name)}&pr=${price}&d=${encodeURIComponent(desc)}&i=${encodeURIComponent(img)}`;
        navigator.clipboard.writeText(url).then(() => alert("Ù„ÛŒÙ†Ú© Ù‡Ø§ØªÛ• Ú©Û†Ù¾ÛŒÚ©Ø±Ù† âœ…"));
    }

    // ================= Customer Logic =================
    function loadCustomer(params) {
        productData.name = params.get('p');
        productData.price = parseFloat(params.get('pr'));
        productData.desc = params.get('d');
        productData.img = params.get('i');

        document.getElementById('cName').innerText = productData.name;
        document.getElementById('cPriceBadge').innerText = productData.price.toLocaleString() + ' Ø¯.Ø¹';
        document.getElementById('cDesc').innerText = productData.desc;
        document.getElementById('cImg').src = productData.img;
        
        updateTotal();
        setTimeout(initMap, 500); // Delay for layout render
    }

    function updateQty(n) {
        if (orderData.qty + n > 0) {
            orderData.qty += n;
            document.getElementById('qtyDisplay').innerText = orderData.qty;
            updateTotal();
        }
    }

    function updateTotal() {
        const delivery = parseInt(document.getElementById('citySelect').value);
        const total = (productData.price * orderData.qty) + delivery;
        document.getElementById('sTotal').innerText = total.toLocaleString() + ' Ø¯.Ø¹';
    }

    // ================= Map & Location =================
    function initMap() {
        // Default: Duhok
        const lat = 36.8679, lng = 42.9489;
        map = L.map('map').setView([lat, lng], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
        marker = L.marker([lat, lng], {draggable: true}).addTo(map);

        function updateMarker(lat, lng) {
            marker.setLatLng([lat, lng]);
            orderData.lat = lat;
            orderData.lng = lng;
            document.getElementById('geoStatus').innerText = `âœ… Ù‡Ø§ØªÛ• Ø¯ÛŒØ§Ø±Ú©Ø±Ù†: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            document.getElementById('geoStatus').classList.add('text-success');
        }

        marker.on('dragend', e => { const p = e.target.getLatLng(); updateMarker(p.lat, p.lng); });
        map.on('click', e => updateMarker(e.latlng.lat, e.latlng.lng));
        
        // Expose function for button
        window.updateMapLocation = (lat, lng) => {
            map.setView([lat, lng], 16);
            updateMarker(lat, lng);
        };
    }

    function getMyLocation() {
        if (!navigator.geolocation) return alert("GPS Ú©Ø§Ø± Ù†Ø§Ú©Û•Øª");
        document.getElementById('geoStatus').innerText = "Ø¬Ø§Ø±ÛŒ Ù„ÛÚ¯Û•Ø±ÛŒØ§Ù†...";
        navigator.geolocation.getCurrentPosition(
            pos => window.updateMapLocation(pos.coords.latitude, pos.coords.longitude),
            err => alert("Ù†Û•Ø´ÛŒØ§Ù… Ø¬Ù‡Û ØªÛ• Ø¨ÛŒÙ†Ù…ØŒ Ù‡ÛŒÚ¤ÛŒÛ• Ù„ Ø³Û•Ø± Ù†Û•Ø®Ø´Û•ÛŒ Ø¯ÛŒØ§Ø± Ø¨Ú©Û•"),
            { enableHighAccuracy: true } // Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©
        );
    }

    // ================= Export & Send =================
    function validateForm() {
        const name = document.getElementById('custName').value;
        const phone = document.getElementById('custPhone').value;
        if(!name || !phone) { alert("Ù†Ø§Ú¤ Ùˆ Ú˜Ù…Ø§Ø±Ø§ ØªÛ•Ù„Û•ÙÛ†Ù†Û Ù¾ÛØ¯Ú¤ÛŒÙ†Û•!"); return false; }
        return { name, phone, address: document.getElementById('custAddress').value };
    }

    function prepareData() {
        const formData = validateForm();
        if(!formData) return null;
        
        const select = document.getElementById('citySelect');
        const delivery = parseInt(select.value);
        const subtotal = productData.price * orderData.qty;
        const total = subtotal + delivery;
        const mapLink = orderData.lat ? `https://maps.google.com/?q=${orderData.lat},${orderData.lng}` : "";

        return { ...formData, delivery, subtotal, total, mapLink, cityName: select.options[select.selectedIndex].text };
    }

    function sendOrder() {
        const data = prepareData();
        if(!data) return;

        const msg = `ğŸ§¾ *Ø¯Ø§Ø®ÙˆØ§Ø²ÛŒ (Order)*
ğŸ“¦ *${productData.name}*
ğŸ’° Ø¨Ù‡Ø§: ${productData.price.toLocaleString()}
ğŸ”¢ Ù‡Ú˜Ù…Ø§Ø±: ${orderData.qty}
ğŸš› Ú¯Û•Ù‡Ø§Ù†Ø¯Ù†: ${data.delivery.toLocaleString()}
ğŸ’µ *Ø³Û•Ø±Ø¬Û•Ù…: ${data.total.toLocaleString()} Ø¯.Ø¹*
------------------
ğŸ‘¤ ${data.name}
ğŸ“± ${data.phone}
ğŸ“ ${data.cityName}
ğŸ  ${data.address}
ğŸŒ ${data.mapLink}`;

        window.open(`https://wa.me/${MERCHANT_PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function downloadPDF() {
        const data = prepareData();
        if(!data) return;

        // Fill Template
        document.getElementById('inv-date').innerText = new Date().toLocaleDateString('en-GB');
        document.getElementById('inv-id').innerText = Math.floor(Math.random()*90000) + 10000;
        document.getElementById('inv-custName').innerText = data.name;
        document.getElementById('inv-custPhone').innerText = data.phone;
        document.getElementById('inv-address').innerText = data.cityName + " - " + data.address;
        
        document.getElementById('inv-pName').innerText = productData.name;
        document.getElementById('inv-pPrice').innerText = productData.price.toLocaleString();
        document.getElementById('inv-qty').innerText = orderData.qty;
        document.getElementById('inv-subtotal').innerText = data.subtotal.toLocaleString();
        document.getElementById('inv-delivery').innerText = data.delivery.toLocaleString();
        document.getElementById('inv-total').innerText = data.total.toLocaleString() + " Ø¯.Ø¹";

        // Generate QR Code
        document.getElementById('qrcode').innerHTML = "";
        if(data.mapLink) {
            new QRCode(document.getElementById("qrcode"), {
                text: data.mapLink,
                width: 60,
                height: 60
            });
        }

        // Convert to PDF
        const element = document.getElementById('invoice-template');
        element.style.display = 'block'; // Show temporarily
        
        const opt = {
            margin: 0.5,
            filename: `Invoice_${data.name}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save().then(() => {
            element.style.display = 'none'; // Hide again
        });
    }
</script>

</body>
</html>