<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ | Royal Store</title>
    
    <!-- Ø®Ø· ØªØ¬ÙˆØ§Ù„ Ø§Ù„Ø­Ø¯ÙŠØ« -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ø®Ø±Ø§Ø¦Ø· Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <style>
        :root {
            --primary: #4F46E5; /* Ù†ÙŠÙ„ÙŠ ÙØ§Ø®Ø± */
            --primary-dark: #4338ca;
            --accent: #F59E0B; /* Ø°Ù‡Ø¨ÙŠ */
            --bg-body: #F3F4F6;
            --surface: #ffffff;
            --text-main: #111827;
            --text-sub: #6B7280;
            --radius: 24px;
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        .app-container {
            width: 100%;
            max-width: 480px; /* Ø¹Ø±Ø¶ Ø§Ù„Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ */
            background: var(--surface);
            min-height: 100vh;
            box-shadow: 0 0 50px rgba(0,0,0,0.05);
            position: relative;
            padding-bottom: 40px;
        }

        @media(min-width: 481px) {
            .app-container {
                min-height: auto;
                margin: 40px auto;
                border-radius: var(--radius);
                overflow: hidden;
            }
            body { background-color: #eef2ff; }
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .brand-logo {
            font-weight: 800;
            font-size: 22px;
            color: var(--primary);
            letter-spacing: -0.5px;
        }

        /* Ø§Ù„ØµÙˆØ± */
        .hero-image {
            width: 100%;
            height: 320px;
            object-fit: cover;
            border-bottom-right-radius: var(--radius);
            border-bottom-left-radius: var(--radius);
            box-shadow: 0 15px 30px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            background-color: #eee;
        }

        /* Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        .content-padding { padding: 0 25px; }
        
        h1.product-title {
            font-size: 26px;
            font-weight: 700;
            margin: 0 0 10px 0;
            line-height: 1.3;
        }

        .price-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
            margin-bottom: 20px;
        }

        /* Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ© (Floating Labels) */
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #E5E7EB;
            border-radius: 16px;
            font-size: 16px;
            font-family: inherit;
            transition: 0.3s;
            background: #F9FAFB;
            outline: none;
        }

        .input-field:focus {
            border-color: var(--primary);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        .input-label {
            position: absolute;
            top: 18px;
            right: 20px;
            color: var(--text-sub);
            pointer-events: none;
            transition: 0.3s;
            background: transparent;
            font-size: 15px;
        }

        .input-field:focus ~ .input-label,
        .input-field:not(:placeholder-shown) ~ .input-label {
            top: -10px;
            right: 15px;
            background: white;
            padding: 0 5px;
            font-size: 12px;
            font-weight: 700;
            color: var(--primary);
        }

        /* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        #map {
            height: 220px;
            width: 100%;
            border-radius: 18px;
            border: 2px solid #E5E7EB;
            margin-bottom: 10px;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-xl {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 18px;
            font-size: 18px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .btn-whatsapp {
            background-color: #25D366;
            color: white;
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.25);
        }

        .btn-telegram {
            background-color: #229ED9;
            color: white;
            box-shadow: 0 8px 20px rgba(34, 158, 217, 0.25);
        }

        .btn-upload {
            background-color: var(--text-main);
            color: white;
        }

        .btn-xl:active { transform: scale(0.98); }

        /* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none; }

        /* ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù */
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        .file-upload-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .toast-msg {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø± (Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·) -->
    <div id="sellerView" class="hidden">
        <div class="header">
            <div class="brand-logo"><i class="fas fa-crown"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ§Ø¬Ø±</div>
        </div>
        <div class="content-padding fade-in" style="margin-top: 30px;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: #E0E7FF; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: var(--primary); font-size: 30px; margin-bottom: 10px;">
                    <i class="fas fa-camera"></i>
                </div>
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <p style="color: var(--text-sub);">Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙŠØ¹</p>
            </div>

            <div class="file-upload-wrapper mb-3">
                <button class="btn-xl btn-upload">
                    <i class="fas fa-image"></i> Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬
                </button>
                <input type="file" id="imgInput" accept="image/*" onchange="previewFile()">
            </div>
            
            <div class="input-group">
                <input type="text" id="prodName" class="input-field" placeholder=" " autocomplete="off">
                <label class="input-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
            </div>

            <div class="input-group">
                <input type="number" id="prodPrice" class="input-field" placeholder=" " autocomplete="off">
                <label class="input-label">Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ)</label>
            </div>

            <button onclick="createLink()" id="createBtn" class="btn-xl" style="background: var(--primary); color: white;">
                Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨ <i class="fas fa-arrow-left"></i>
            </button>
            
            <div id="resultArea" class="hidden" style="margin-top: 20px; background: #ecfdf5; padding: 15px; border-radius: 12px; border: 1px solid #a7f3d0;">
                <p style="font-size: 13px; color: #047857; margin-bottom: 10px;">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù†Ø³Ø®Ù‡ ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„Ù„Ø²Ø¨ÙˆÙ†:</p>
                <input type="text" id="finalLink" readonly style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 8px; font-size: 12px;">
                <button onclick="copyLink()" style="margin-top: 8px; background: none; border: none; color: #047857; font-weight: bold; cursor: pointer;">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            </div>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† (Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨) -->
    <div id="customerView" class="hidden">
        <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© -->
        <img id="displayImg" src="" class="hero-image fade-in">
        
        <div class="content-padding fade-in" style="animation-delay: 0.1s;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <h1 id="displayName" class="product-title">...</h1>
                    <p style="color: var(--text-sub); margin-bottom: 15px;">Ù…Ù†ØªØ¬ Ø£ØµÙ„ÙŠ ÙˆÙ…Ù…ÙŠØ²</p>
                </div>
                <div style="text-align: left;">
                    <div id="displayPrice" class="price-badge">...</div>
                </div>
            </div>

            <div style="height: 1px; background: #E5E7EB; margin: 20px 0;"></div>

            <h4 style="margin-bottom: 20px;"><i class="far fa-address-card" style="color: var(--primary);"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h4>

            <div class="input-group">
                <input type="text" id="cName" class="input-field" placeholder=" ">
                <label class="input-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            </div>

            <div class="input-group">
                <input type="tel" id="cPhone" class="input-field" placeholder=" ">
                <label class="input-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            </div>

            <div class="input-group">
                <input type="text" id="cAddress" class="input-field" placeholder=" ">
                <label class="input-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŒ Ù†Ù‚Ø·Ø© Ø¯Ø§Ù„Ø©)</label>
            </div>

            <label style="font-size: 14px; font-weight: bold; color: var(--text-main); display: block; margin-bottom: 10px;">
                <i class="fas fa-map-marker-alt" style="color: #EF4444;"></i> Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            </label>
            <div id="map"></div>
            <p id="locText" style="font-size: 12px; color: #059669; text-align: center; margin-bottom: 20px; display:none;">
                <i class="fas fa-check-circle"></i> ØªÙ… Ø­ÙØ¸ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
            </p>

            <button onclick="send('whatsapp')" class="btn-xl btn-whatsapp">
                <i class="fab fa-whatsapp" style="font-size: 24px;"></i> Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
            </button>
            
            <button onclick="send('telegram')" class="btn-xl btn-telegram">
                <i class="fab fa-telegram-plane" style="font-size: 24px;"></i> Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù…
            </button>

            <div style="height: 30px;"></div>
        </div>
    </div>
</div>

<div id="toast" class="toast-msg">ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ
    const MY_NUMBER = "9647503727069";
    const API_KEY = "6d207e02198a847aa98d0a2a901485a5"; // ImgBB API Key

    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    let map, marker, lat, lng;

    function init() {
        const params = new URLSearchParams(window.location.search);
        
        if (params.has('p')) {
            // ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø¨ÙˆÙ†
            document.getElementById('customerView').classList.remove('hidden');
            document.getElementById('displayName').innerText = params.get('p');
            document.getElementById('displayPrice').innerText = Number(params.get('pr')).toLocaleString() + ' Ø¯.Ø¹';
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙˆØ±Ø©
            const imgUrl = params.get('img');
            document.getElementById('displayImg').src = imgUrl;

            setTimeout(initMap, 500);
        } else {
            // ÙˆØ¶Ø¹ Ø§Ù„ØªØ§Ø¬Ø±
            document.getElementById('sellerView').classList.remove('hidden');
        }
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ§Ø¬Ø± ---
    function previewFile() {
        const input = document.getElementById('imgInput');
        const btn = document.querySelector('.btn-upload');
        if(input.files && input.files[0]) {
            btn.innerHTML = `<i class="fas fa-check"></i> ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©`;
            btn.style.background = "#10B981";
            btn.style.borderColor = "#10B981";
        }
    }

    async function createLink() {
        const btn = document.getElementById('createBtn');
        const file = document.getElementById('imgInput').files[0];
        const name = document.getElementById('prodName').value;
        const price = document.getElementById('prodPrice').value;

        if(!name || !price) { showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±"); return; }

        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
        btn.disabled = true;

        let finalImgUrl = "https://placehold.co/600x400/png?text=Product";

        if(file) {
            const formData = new FormData();
            formData.append("image", file);
            try {
                const req = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, { method: "POST", body: formData });
                const res = await req.json();
                if(res.success) finalImgUrl = res.data.url;
            } catch(e) { console.error(e); }
        }

        const link = `${window.location.origin}${window.location.pathname}?p=${encodeURIComponent(name)}&pr=${price}&img=${encodeURIComponent(finalImgUrl)}`;
        
        document.getElementById('resultArea').classList.remove('hidden');
        document.getElementById('finalLink').value = link;
        btn.innerHTML = 'Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¢Ø®Ø±';
        btn.disabled = false;
    }

    function copyLink() {
        const txt = document.getElementById('finalLink');
        txt.select();
        document.execCommand("copy");
        showToast("ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­!");
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø²Ø¨ÙˆÙ† ---
    function initMap() {
        map = L.map('map').setView([33.3128, 44.3615], 11); // Ø¨ØºØ¯Ø§Ø¯
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                map.setView([pos.coords.latitude, pos.coords.longitude], 15);
            });
        }

        map.on('click', e => {
            if(marker) map.removeLayer(marker);
            marker = L.marker(e.latlng).addTo(map);
            lat = e.latlng.lat;
            lng = e.latlng.lng;
            document.getElementById('locText').style.display = 'block';
        });
    }

    function send(app) {
        const name = document.getElementById('cName').value;
        const phone = document.getElementById('cPhone').value;
        const address = document.getElementById('cAddress').value;
        const product = document.getElementById('displayName').innerText;
        const price = document.getElementById('displayPrice').innerText;

        if(!name || !phone || !address) { showToast("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); return; }

        const mapUrl = lat ? `https://maps.google.com/?q=${lat},${lng}` : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        
        const msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (VIP) âœ¨*
ğŸ“¦ *Ø§Ù„Ù…Ù†ØªØ¬:* ${product}
ğŸ’° *Ø§Ù„Ø³Ø¹Ø±:* ${price}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¤ *Ø§Ù„Ø§Ø³Ù…:* ${name}
ğŸ“± *Ø§Ù„Ù‡Ø§ØªÙ:* ${phone}
ğŸ  *Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${address}
ğŸ“ *Ø§Ù„Ù…ÙˆÙ‚Ø¹:* ${mapUrl}`;

        const encoded = encodeURIComponent(msg);
        let link = "";
        
        if(app === 'whatsapp') link = `https://wa.me/${MY_NUMBER}?text=${encoded}`;
        else link = `https://t.me/share/url?url=${encoded}&text=${encoded}`;

        window.open(link, '_blank');
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.display = "block";
        setTimeout(() => t.style.display = "none", 3000);
    }

    window.onload = init;
</script>

</body>
</html>